# Frontend vs Backend API Inconsistencies

## Critical: Schema/Model Mismatches

### 1. VideoTag — Wrong fields entirely
| Field | Frontend Mock | Backend Model |
|-------|-------------|---------------|
| `category` | Present ("Region", "Topic", "Type") | **Does not exist** |
| `video_count` | Present (number) | **Does not exist** |
| `description` | Missing | Present (String) |
| `slug` | Missing | Present (String, unique, auto-generated) |
| `color` | Missing | Present (String) |
| `is_active` | Missing | Present (Boolean, default true) |

**Impact:** VideoTagsPage displays `category` and `video_count` — neither exist in the backend. The page needs to be restructured around `name`, `description`, `slug`, `color`, `is_active`. Video counts would need to be computed via the VideoTagMapping collection or returned by the API as a join.

---

### 2. Notification — Completely different data model
| Concept | Frontend Mock | Backend Model |
|---------|-------------|---------------|
| Purpose | Campaign management (bulk push notifications) | Per-user notification records |
| Fields | title, body, type (promotional/reminder/etc), target, target_count, delivered_count, read_count, click_count, status (delivered/scheduled), channel, created_by | user_id, title, message, type, related_entity_id, is_read, read_at, action_url |

**Impact:** The entire NotificationsPage is designed around a **campaign management** concept (push notification campaigns with delivery metrics) that doesn't exist in the backend. The backend only stores individual per-user notifications (like "Your session starts in 30 minutes"). There are **no admin endpoints for managing notification campaigns** — no create/send/schedule notification APIs exist in the admin routes.

**Resolution needed:** Either:
- (a) Build backend campaign management endpoints (admin notification CRUD + FCM sending), or
- (b) Redesign the page to show user-level notification logs instead

---

### 3. Banner — Field name mismatches
| Field | Frontend Mock | Backend Model |
|-------|-------------|---------------|
| `subtitle` | Present | **Does not exist** (use `description`) |
| `click_url` | Present | **Does not exist** (use `action_url`) |
| `display_order` | Present | **Does not exist** (use `position`) |

**Impact:** BannersPage uses wrong field names. Will get `undefined` when connected to real API.

---

### 4. Payment — No unified model exists
| Frontend | Backend Reality |
|----------|----------------|
| Single `mockPayments` array with `transaction_id`, `payment_id`, `method`, `upi_id`, `card_last4`, `bank_name`, `purchase_type` | **No unified Payment model.** Payments are split across: `UserPurchase` (packages), `SessionPurchase` (sessions), `BookOrder` (books) |

The admin endpoint `GET /admin/payments/transactions` likely aggregates these into a unified response, but the response schema may differ from the mock. Fields like `method`, `upi_id`, `card_last4`, `bank_name` are **not stored in any backend model** — payment method details are held by Zoho Payments, not in the PGME database.

**Impact:** PaymentsPage may show empty columns for payment method details unless the API enriches responses with Zoho data.

---

### 5. LiveSession — Platform enum mismatch
| Frontend (SessionFormModal) | Backend Model |
|-----------------------------|---------------|
| `zoom`, `google_meet`, `custom` | `zoom`, `agora`, `teams`, `other` |

**Impact:** Frontend allows `google_meet` and `custom` — backend will reject these. Backend allows `agora` and `teams` — frontend doesn't offer these.

---

### 6. LiveSession — Missing fields in frontend
| Missing from Frontend | Backend Model |
|-----------------------|---------------|
| `series_id` | Optional reference to Series |
| `enrollment_mode: 'disabled'` | Third option exists in backend |
| `zoom_meeting_id` | Auto-generated by backend |
| `meeting_link` | Auto-generated by backend |
| `compare_at_price` | For showing "was ₹X" pricing |
| `auto_admit_users` | Zoom setting |
| `allow_join_before_host` | Zoom setting |
| `admin_capacity_override` | Override capacity |
| `override_max_attendees` | Override value |

---

### 7. Invoice — Missing/wrong fields
| Field | Frontend Mock | Backend Model |
|-------|-------------|---------------|
| `user_name` | Present (computed) | **Not stored** — needs join on user_id |
| `item_name` | Present (computed) | **Not stored** — needs join on purchase_id |
| `invoice_url` | Missing | Present (Zoho URL) |
| `zoho_customer_payment_id` | Missing | Present |
| `payment_recorded_at` | Missing | Present |

---

### 8. AdminUser — Role stored differently
| Frontend | Backend |
|----------|---------|
| `role_name: string` | `role_id: ObjectId` (ref AdminRole) |

The API likely returns `role_name` as a populated field, but the form would need to send `role_id` when creating/updating.

---

## Moderate: Missing Services (all pages use mock data)

Only **SubjectsPage** has a real API service. Every other page uses `mockData`:

| Page | Has Service? | Admin API Exists? |
|------|-------------|-------------------|
| SubjectsPage | **Yes** (subjects.service.ts) | Yes |
| PackagesPage | No | Yes - full CRUD |
| SeriesPage | No | Yes - full CRUD |
| ModulesPage | No | Yes - full CRUD |
| VideosPage | No | Yes - full CRUD + tag mgmt |
| DocumentsPage | No | Yes - full CRUD |
| VideoTagsPage | No | Yes - full CRUD |
| SessionsPage | No | Yes - full CRUD + cancel |
| FacultyPage | No | Yes - full CRUD + verify |
| UsersPage | No | Yes - list/block/unblock/extend |
| BooksPage | No | Yes - full CRUD + stock + images |
| BookOrdersPage | No | Yes - list/status/shipping |
| PurchasesPage | No | Yes (via payments/transactions) |
| PaymentsPage | No | Yes - transactions/reconciliation/failed |
| InvoicesPage | No | Yes - CRUD + regenerate + download |
| RevenuePage | No | Yes - by-type/trends/top/forecast |
| BannersPage | No | Yes - full CRUD |
| AnalyticsPage | No | Yes - /admin/analytics/dashboard |
| NotificationsPage | No | **No** - no admin notification campaign endpoints |
| AdminUsersPage | No | Yes - full CRUD + activate/deactivate |
| AdminRolesPage | No | Yes - full CRUD |
| AppSettingsPage | No | Yes (public GET only) |

**19 services need to be built** to connect all pages to real APIs.

---

## Minor: Computed/Joined fields in mock data

These fields exist in mock data for display convenience but are **not stored in the backend model** — they come from populated joins in API responses:

| Mock Array | Computed Fields |
|-----------|----------------|
| mockModules | `series_name`, `package_name` |
| mockDocuments | `series_name` |
| mockLiveSessions | `subject_name`, `faculty_name`, `enrolled_count` |
| mockPackages | `subject_name`, `type_name`, `enrolled_count` |
| mockSeries | `module_count`, `package_name` |
| mockVideos | `faculty_name`, `module_name` |
| mockPurchases | `user_name`, `package_name` |
| mockInvoices | `user_name`, `item_name` |
| mockPayments | `user_name`, `item_name` |

These are **not bugs** — the backend API likely returns these as populated fields. But when creating TypeScript interfaces for API responses, these should be marked as populated/optional since they come from joins, not the base document.

---

## Missing Frontend Pages for Existing Backend Endpoints

| Backend Feature | Admin Endpoint Exists | Frontend Page |
|-----------------|----------------------|---------------|
| Package Types | GET `/package-types` (public) | **No page** |
| Session Enrollments | `/admin/session-enrollments` (4 endpoints) | **No page** |
| Legal Documents | GET `/legal-documents` (public only) | **No page** |
| Media Upload | POST `/media/upload` | **No page** (FileUpload component exists but no management) |
| Zoom Config | POST `/admin/live-sessions/zoom/configure-restrictions` | **Not exposed in UI** |
| Faculty Performance | GET `/admin/faculty/:id/performance` | **Not exposed in UI** |
| Faculty Schedule | GET `/admin/faculty/:id/schedule` | **Not exposed in UI** |
| Book Low Stock | GET `/admin/books/low-stock` | **Not exposed in UI** |
| Book Bulk Stock | POST `/admin/books/stock/bulk-update` | **Not exposed in UI** |
| Book Images | POST/DELETE `/admin/books/:id/images` | **Not exposed in UI** |
| Payment Reconciliation | GET `/admin/payments/reconciliation` | **Not exposed in UI** |
| Payment Failed | GET `/admin/payments/failed` | **Not exposed in UI** |
| Revenue Trends | GET `/admin/revenue/trends` | **RevenuePage exists but uses mock calculations, not API** |
| Revenue Forecast | GET `/admin/revenue/forecast` | **Not exposed in UI** |
| Invoice Download | GET `/admin/invoices/:id/download` | **Not exposed in UI** |
| Invoice Regenerate | POST `/admin/invoices/:id/regenerate` | **Not exposed in UI** |

---

## Summary of Required Fixes (Priority Order)

### P0 — Will break when connecting to API
1. **VideoTag schema** — Remove `category`/`video_count`, add `description`/`slug`/`color`/`is_active`
2. **Banner field names** — `subtitle` → `description`, `click_url` → `action_url`, `display_order` → `position`
3. **LiveSession platform enum** — Change `google_meet`/`custom` → `agora`/`teams`/`other`
4. **Notification model** — Complete redesign needed (campaign vs per-user)

### P1 — Needed for full functionality
5. Build 19 API service files following `subjects.service.ts` pattern
6. Add TypeScript interfaces matching actual API response schemas
7. Connect all pages to real APIs, replace mock data
8. Add `enrollment_mode: 'disabled'` to SessionFormModal

### P2 — Missing features
9. Add pages for: Session Enrollments, Package Types
10. Add UI for: Faculty performance/schedule, book stock management, payment reconciliation
11. Wire up revenue page to `/admin/revenue/*` endpoints
12. Add invoice download/regenerate buttons to InvoicesPage
